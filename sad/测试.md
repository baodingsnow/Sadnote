浏览器返回的字段和后台不一样

- [x] IF NULL函数
- [ ] 断点都打在哪里
- [ ] getById 改写       改写成一次查询   
- [ ] sql语句  IFNULL后面加字段
- [ ] getBaseMapper的作用



# 注解

**@PathVariable**

通过 @PathVariable 可以将URL中占位符参数{xxx}，绑定到处理器类的方法形参中@PathVariable(“xxx“)

```Java
@Deletemapping("/delete/{id}")
public boolean deleteTeacher (@PathVariable String id){
    boolean a=xxService.removeById(id);
    return a;
}
    
```

**@Parameter注解**

在实际的开发中，经常会遇到多个接口参数的情况。在之前的例子中，我们都是将多个参数合并到一个JavaBean中，但是不可能每次都为不同的参数创建一个新的JavaBean，所以需要使用其他方式来传递多个参数，常见的方法有使用Map类型和使用@param注解。

**@RequestBody**

通过Http传递参数一般有两种方式，一种是通过url解析参数，一种是通过body来解决，那么我们本次说的RequestBody就是去解析请求体然后映射到我们的参数

**@Valid注解**

用于验证注解是否符合要求，直接加在变量user之前，在变量中添加验证信息的要求，当不符合要求时就会在方法中返回message 的错误提示信息。

然后在实体类添加要求

**@Bean注解**

# 代码开发

### 保存功能

```Java
 public boolean saveAlarm(String target,String targetId,RuleDeviceAlarm alarm){
     alarm.setTarget;
     alarm.setTargetId;
     return save(alarm);
 }
```

### 查询功能

```java
@GetMapping("/id")
@Operation(summary="根据id查询")
public Result getById(@Pathvarible id){
    Iotproduct e=iotProductService.getByProductId(id);
    if (e!=null){
        return Result.success(e);
    }
    return Result.error(HttpStatus.Not_Found,"not_found", null);
    
}
```

# 启动程序必要条件

> 注意一下端口号

application-dev.yml

```yaml
spring:
  cloud:
    nacos:
      discovery:
        server-addr: 8.141.160.231:8849
        enabled: true
        namespace: iot
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://8.141.160.231:3309/yang_test?useSSL=false&useUnicode=true&characterEncoding=utf8&useSSL=false&useTimezone=true&serverTimezone=GMT%2B8
    username: root
    password: 123.com
    type: com.zaxxer.hikari.HikariDataSource
    hikari:
      minimum-idle: 5
      auto-commit: true
      idle-timeout: 10000
      max-lifetime: 1800000
      connection-timeout: 30000
      connection-test-query: SELECT 1

logging:
  level:
    root: INFO

```

application-local.yml

```yml
spring:
  cloud:
    nacos:
      discovery:
        server-addr: 8.141.160.231:8849
        enabled: true
        namespace: iot
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://8.141.160.231:6009/iot_cloud_platform?useSSL=false&useUnicode=true&characterEncoding=utf8&useSSL=false&useTimezone=true&serverTimezone=GMT%2B8
    username: root
    password: 123456
    type: com.zaxxer.hikari.HikariDataSource
    hikari:
      minimum-idle: 5
      auto-commit: true
      idle-timeout: 10000
      max-lifetime: 1800000
      connection-timeout: 30000
      connection-test-query: SELECT 1
  mqtt:
    #MQTT服务地址，端口号默认1883，如果有多个，用逗号隔开
    server:
      url: tcp://8.141.160.231
      port: 1883
      #用户名
      username: admin
      #密码
      password: public
    #客户端id(不能重复)
    client:
      consumerId: consumer_event_bus_02
      publishId: publish-event-bus
    #MQTT默认的消息推送主题，实际可在调用接口是指定
    default:
      topic: topic
      completionTimeout: 2000
      keepAliveInterval: 3000
      connectionTimeout: 3000
  elasticsearch:
    rest:
      uris:http://8.141.160.231:9200
management:
  endpoints:
    web:
      exposure:
        include: '*'
  endpoint:
    health:
      show-details: always
  metrics:
    tags:
      appliction: iot-device
dev:
  test: 123
logging:
  level:
    root: INFO

```

bootstrap.yml

```yml
server:
  port: 8902
spring:
  application:
    name: iot-device
  cloud:
    nacos:
      config:
        server-addr: 8.141.160.231:8849
        file-extension: yaml
        namespace: iot
        refresh-enabled: true
  profiles:
    active: local
info:
  app:
    name: ${spring.applcation.name}
```

restClientConfig

```yml
    public RestHighLevelClient elasticsearchClient() {

        final ClientConfiguration clientConfiguration = ClientConfiguration.builder()
                .connectedTo("127.0.0.1:9200")
                .build();
```



# 测试中发现的问题

### 错误的请求参数导致的400问题

alarmrule中保存告警配置接口，请求中应该包含一个嵌套json，alarm， 所以要用DeviceAlarmRule类型修饰alarmRule

![image-20220623141013702](C:\Users\GW00273483\AppData\Roaming\Typora\typora-user-images\image-20220623141013702.png)





再比如我有一个User类，User类中有一个属性叫做interest，这个属性用来描述用户的爱好，它的数据类型是一个List集合，那么我想在把这个List集合存入数据库的时候能够自动的变成`{XXX,XXX,XXX}`这样一个字符串然后存起来，当我从数据库读取的时候也是读取到这样一个字符串，读取成功之后再自动的将之转为一个List集合

### 数据库表字段和实体类属性一致问题

数据库表中的字段和实体类属性需要一一对应，否者会报500错误

两者通过资源文件中的xml文件联系在一起（SSMP框架下通常是）

```java
        alarm.setState(AlarmState.stopped);
        alarm.setTarget(target);
        alarm.setTargetId(targetID);
        boolean flag1=true;
        if (alarm.getId()!=null){
             flag1= ruleInstanceService.saveOrUpdate(alarm.toRuleInstance());
        }
        boolean flag2=this.saveOrUpdate(alarm);
        if(flag1&&flag2){
            return true;
        }
       return false;
```



